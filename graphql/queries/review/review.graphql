query getOrdersWithReviews($user_id: uuid!) {
  order_item(
    where: {
      _and: [
        { product: { reviews: { user_id: { _is_null: true } } } }
        { order_tenant: { order_status: { value: { _eq: "Delivered" } } } }
      ]
    }
  ) {
    id
    order_tenant {
      order_status {
        value
      }
      updated_at
    }
    created_at
    product {
      slug
      id
      name
      image_url
      reviews_aggregate {
        aggregate {
          count
        }
      }
    }
  }
  review(where: { user_id: { _eq: $user_id } }) {
    id
    comment
    score
    created_at
    product {
      slug
      name
      id
      image_url
      product_categories {
        category {
          name
          slug
          id
        }
      }
      tenant {
        id
        picture
      }
      reviews_aggregate {
        aggregate {
          count
        }
      }
    }
  }
}

mutation createReview($comment: String!, $score: Int!, $product_id: Int!) {
  insert_review_one(
    object: { comment: $comment, score: $score, product_id: $product_id }
  ) {
    created_at
  }
}

query getProductReviews($productId: Int, $limit: Int = 10, $offset: Int = 0) {
  review(
    where: { product_id: { _eq: $productId } }
    limit: $limit
    offset: $offset
  ) {
    id
    comment
    score
    created_at
    user {
      firstname
      lastname
    }
  }
  review_aggregate {
    aggregate {
      count
    }
  }
}
